# ğŸš€ API Test è‡ªåŠ¨åŒ–æ¡†æ¶

[![Build Status](https://img.shields.io/badge/build-passing-brightgreen.svg)](https://github.com/1p1e3/api_test/actions)
[![Python](https://img.shields.io/badge/python-3.13%2B-blue.svg)](https://www.python.org/)
[![Tests](https://img.shields.io/badge/tests-pytest-yellowgreen.svg)](#)



è¿™æ˜¯ä¸€ä¸ªåŸºäº Python çš„æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•é¡¹ç›®ï¼ŒåŒ…å«ç”¨ä¾‹ç®¡ç†ã€HTTP å®¢æˆ·ç«¯å°è£…ã€æ•°æ®åº“å®¢æˆ·ç«¯å’Œæµ‹è¯•æŠ¥å‘Šè¾“å‡ºç­‰å¸¸ç”¨åŠŸèƒ½ã€‚

ä¸»è¦ç‰¹æ€§ âœ¨

 - æµ‹è¯•æ‰§è¡Œä¸æŠ¥å‘Š ğŸ§¾
	- åŸºäº `pytest` çš„æµ‹è¯•æ‰§è¡Œï¼Œæ˜“äºä½¿ç”¨ fixtureã€æ ‡è®°ã€å‚æ•°åŒ–å’Œå¹¶è¡ŒåŒ–ï¼ˆå¯åœ¨ CI ä¸­æ— ç¼é›†æˆï¼‰ã€‚
	- æ”¯æŒ `pytest-html` ç”Ÿæˆç»“æ„åŒ– HTML æŠ¥å‘Šï¼Œæµ‹è¯•è¾“å‡ºä¿å­˜åœ¨ `reports/` ç›®å½•ï¼Œä¾¿äºå½’æ¡£ä¸å®¡æŸ¥ã€‚

 - æ•°æ®é©±åŠ¨ä¸ç”¨ä¾‹ç®¡ç† ğŸ—‚ï¸
	- æ”¯æŒ JSON ä¸ YAML æ ¼å¼çš„æµ‹è¯•æ•°æ®ï¼ˆå­˜æ”¾åœ¨ `cases/`ï¼‰ï¼Œé€šè¿‡ç®€å•çš„æ˜ å°„æœºåˆ¶æŠŠæ•°æ®æ³¨å…¥æµ‹è¯•ç”¨ä¾‹ï¼Œå®ç°åŒä¸€æ¥å£å¤šåœºæ™¯è¦†ç›–ã€‚
	- æä¾› `core/ddt.py`ï¼ˆç®€å•æ•°æ®é©±åŠ¨å®ç°ï¼‰ç”¨äºå°†æ•°æ®æ–‡ä»¶ä¸æµ‹è¯•å‡½æ•°ç»‘å®šï¼Œå‡å°‘æ ·æ¿ä»£ç ã€‚

 - HTTP å®¢æˆ·ç«¯å°è£… (`core/api_client.py`) ğŸ”Œ
	- é›†ä¸­ç®¡ç† `base_url`ã€è¯·æ±‚å¤´ã€ä¼šè¯ï¼ˆcookies/sessionï¼‰å’Œé‰´æƒé€»è¾‘ï¼Œæµ‹è¯•ç”¨ä¾‹åªéœ€æè¿°æ¥å£å’Œæ–­è¨€ã€‚
	- å†…å»ºè¶…æ—¶ã€é‡è¯•ä¸é”™è¯¯æ—¥å¿—ç­–ç•¥ï¼Œç»Ÿä¸€å¤„ç†å¼‚å¸¸ä¸é‡è¯•é€»è¾‘ï¼Œå‡å°‘æµ‹è¯•ä¸ç¨³å®šæ€§ã€‚
	- æ”¯æŒè¯·æ±‚/å“åº”çš„ç»Ÿä¸€æ—¥å¿—æ ¼å¼ï¼Œä¾¿äºåœ¨ `logs/` ä¸­å®šä½é—®é¢˜ã€‚

 - æ•°æ®åº“æ”¯æŒ (`core/mysql_client.py`) ğŸ—„ï¸
	- åŸºäº `pymysql`/`sqlalchemy` çš„æ•°æ®åº“è®¿é—®å°è£…ï¼Œæ”¯æŒè¿æ¥é…ç½®ã€äº‹åŠ¡æ§åˆ¶å’Œå¸¸ç”¨æŸ¥è¯¢/æ‰§è¡Œæ–¹æ³•ã€‚
	- ä¸ºæµ‹è¯•å‰ç½®ï¼ˆtest setupï¼‰ä¸åç½®æ¸…ç†æä¾›æ–¹ä¾¿çš„æ¥å£ï¼Œæ”¯æŒæµ‹è¯•æ•°æ®æ³¨å…¥ä¸å›æ»šç­–ç•¥ã€‚

 - æ¨¡å‹ä¸æ•°æ®æ ¡éªŒ âœ…
	- ä½¿ç”¨ Pydanticï¼ˆ`pydantic-settings`ï¼‰æˆ–è‡ªå®šä¹‰æ•°æ®æ¨¡å‹åœ¨ `response_models/` ä¸­å®šä¹‰å“åº”æ¨¡å‹ï¼Œä¾¿äºå¯¹æ¥å£è¿”å›è¿›è¡Œç»“æ„åŒ–æ ¡éªŒä¸ç±»å‹è½¬æ¢ã€‚

 - æ–­è¨€ä¸å·¥å…·å‡½æ•°ï¼ˆ`utils/`ï¼‰ ğŸ§°
	- `utils/assertions.py` æä¾›ä¸€è‡´çš„æ–­è¨€æ–¹æ³•ï¼ˆçŠ¶æ€ç ã€å­—æ®µå­˜åœ¨æ€§ã€ç²¾ç¡®/æ¨¡ç³ŠåŒ¹é…ã€æ­£åˆ™ç­‰ï¼‰ï¼Œé™ä½æµ‹è¯•ç»´æŠ¤æˆæœ¬ã€‚
	- `utils/data_loader.py` ä¸ `utils/notifier.py` åˆ†åˆ«å¤„ç†æµ‹è¯•æ•°æ®åŠ è½½ä¸ç»“æœé€šçŸ¥ï¼ˆé‚®ä»¶/é’‰é’‰/Webhook å¯æ‹“å±•ï¼‰ã€‚

 - Mock ä¸éš”ç¦»æµ‹è¯• ğŸ§ª
	- é›†æˆ `responses` åº“ä»¥ä¾¿åœ¨å•å…ƒ/é›†æˆæµ‹è¯•ä¸­æ›¿ä»£å¤–éƒ¨ HTTP è°ƒç”¨ï¼Œå®ç°å¿«é€Ÿã€ç¨³å®šçš„ç¦»çº¿æµ‹è¯•ã€‚

 - å¯é…ç½®ä¸ç¯å¢ƒéš”ç¦» ğŸŒ
	- å°†ç¯å¢ƒç›¸å…³é…ç½®ï¼ˆå¦‚ base URLã€æ•°æ®åº“è¿æ¥ï¼‰æ”¾åœ¨ `config/settings.py`ï¼Œæ”¯æŒ `.env` ä¸ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§ï¼Œæ–¹ä¾¿åœ¨ä¸åŒæµ‹è¯•ç¯å¢ƒé—´åˆ‡æ¢ã€‚

 - å¯æ‰©å±•æ€§ä¸ CI å‹å¥½ ğŸ”
	- è®¾è®¡ä¸ºæ¨¡å—åŒ–ç»“æ„ï¼Œä¾¿äºç”¨ä¾‹åº“ã€å®¢æˆ·ç«¯æˆ–æŠ¥å‘Šæ’ä»¶çš„æ‰©å±•ã€‚
	- ä¸ä¸»æµ CI ç³»ç»Ÿå…¼å®¹ï¼šåœ¨ CI ä¸­å¯è‡ªåŠ¨æ‰§è¡Œæµ‹è¯•å¹¶ä¿å­˜ `reports/` ä¸ `logs/` ä½œä¸ºæ„å»ºäº§ç‰©ã€‚

 - å¯è§‚æµ‹æ€§ ğŸ‘€
	- è¿è¡Œæ—¶æ—¥å¿—å†™å…¥åˆ° `logs/`ï¼ŒæŠ¥å‘Šä¸æ—¥å¿—ç»“åˆä¾¿äºå¿«é€Ÿå®šä½å¤±è´¥åŸå› ã€‚

 - å®‰å…¨ä¸æ•æ„Ÿä¿¡æ¯ç®¡ç† ğŸ”’
	- ä¸æŠŠå¯†é’¥æˆ–å¯†ç å†™å…¥ä»“åº“ï¼Œå»ºè®®ä½¿ç”¨ `.env` æˆ– CI çš„ç§˜å¯†å­˜å‚¨æ¥æ³¨å…¥æ•æ„Ÿé…ç½®ã€‚

 - ç¤ºä¾‹ä¸æ¨¡æ¿ ğŸ“š
	- é¡¹ç›®åŒ…å«ç¤ºä¾‹æµ‹è¯•æ–‡ä»¶ä¸æ•°æ®ï¼ˆ`tests/`ã€`cases/`ï¼‰ï¼Œä½œä¸ºç¼–å†™æ–°ç”¨ä¾‹çš„æ¨¡æ¿ï¼Œé™ä½æ–°æˆå‘˜ä¸Šæ‰‹æˆæœ¬ã€‚


è¦æ±‚
- Python >= 3.13
- ä¾èµ–è§ `pyproject.toml` ä¸­çš„ `dependencies` é…ç½®ï¼ˆä¾‹å¦‚ `requests`, `pytest`, `pydantic-settings`, `sqlalchemy` ç­‰ï¼‰ã€‚

å¿«é€Ÿå¼€å§‹

1. å…‹éš†ä»“åº“å¹¶è¿›å…¥é¡¹ç›®ç›®å½•ï¼š

```bash
git clone <repo-url>
cd api_test
```

2. å»ºè®®åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š

```bash
python -m venv .venv
# Windows
.venv\Scripts\activate
# Unix/macOS
source .venv/bin/activate
```

3. å®‰è£…ä¾èµ–ï¼ˆå¯é€‰æ–¹å¼ï¼Œæ ¹æ®åå¥½é€‰æ‹©ï¼‰ï¼š

- ä½¿ç”¨ `pip` å®‰è£…æœ¬åœ°å¯ç¼–è¾‘åŒ…ï¼ˆä¼šè¯»å– `pyproject.toml` çš„ä¾èµ–ï¼‰ï¼š

```bash
python -m pip install -U pip build
python -m pip install -e .
```

- æˆ–æ‰‹åŠ¨ä» `pyproject.toml` æå–ä¸º `requirements.txt` åï¼š

```bash
python -m pip install -r requirements.txt
```

è¿è¡Œæµ‹è¯•

- è¿è¡Œå…¨éƒ¨æµ‹è¯•ï¼š

```bash
pytest
```

- ç”Ÿæˆ HTML æŠ¥å‘Šï¼š

```bash
pytest --html=reports/report.html
```

é¡¹ç›®ç»“æ„æ¦‚è§ˆ

- [conftest.py](conftest.py)ï¼špytest å…¨å±€é…ç½®å’Œå›ºä»¶ã€‚
- [main.py](main.py)ï¼šé¡¹ç›®å…¥å£ï¼ˆå¯ç”¨äºå¿«é€Ÿæ‰‹åŠ¨è§¦å‘æˆ–é›†æˆè°ƒè¯•ï¼‰ã€‚
- [pyproject.toml](pyproject.toml)ï¼šé¡¹ç›®å…ƒæ•°æ®ä¸ä¾èµ–å£°æ˜ã€‚
- [cases/](cases/)ï¼šæµ‹è¯•æ•°æ®ç›®å½•ï¼ŒåŒ…å« `test_login.json`ã€`test_user.yaml` ç­‰ã€‚
- [config/paths.py](config/paths.py)ã€[config/settings.py](config/settings.py)ï¼šé…ç½®åŠè·¯å¾„ç®¡ç†ã€‚
- [core/api_client.py](core/api_client.py)ï¼šHTTP å®¢æˆ·ç«¯å°è£…ã€‚
- [core/mysql_client.py](core/mysql_client.py)ï¼šMySQL æ•°æ®åº“æ“ä½œå°è£…ã€‚
- [core/ddt.py](core/ddt.py)ï¼šæ•°æ®é©±åŠ¨æµ‹è¯•ï¼ˆç®€å•å®ç°ï¼‰ã€‚
- [models/](models/)ã€[response_models/](response_models/)ï¼šè¯·æ±‚/å“åº”æ¨¡å‹å®šä¹‰ä¸éªŒè¯ã€‚
- [tests/](tests/)ï¼šæµ‹è¯•ç”¨ä¾‹ç›®å½•ï¼ˆç¤ºä¾‹ï¼š`tests/test_user_api.py`ï¼‰ã€‚
- [reports/](reports/)ï¼šæµ‹è¯•æŠ¥å‘Šè¾“å‡ºç›®å½•ã€‚
- [logs/](logs/)ï¼šè¿è¡Œæ—¥å¿—æ–‡ä»¶ã€‚
- [utils/](utils/)ï¼šæ–­è¨€ã€åŠ è½½æ•°æ®ã€é€šçŸ¥å’Œæ—¥å¿—å°è£…ç­‰å·¥å…·å‡½æ•°ã€‚

å…³é”®æ–‡ä»¶è¯´æ˜

- `core/api_client.py`ï¼šç»Ÿä¸€å°è£… `requests` çš„è¯·æ±‚é€»è¾‘ï¼Œé›†ä¸­å¤„ç†è®¤è¯ã€é‡è¯•ã€è¶…æ—¶å’Œæ—¥å¿—ã€‚
- `core/mysql_client.py`ï¼šåŸºäº `pymysql`/`sqlalchemy` çš„æ•°æ®åº“è¯»å†™è¾…åŠ©ï¼Œç”¨äºæµ‹è¯•å‰ç½®ä¸æ–­è¨€æ•°æ®å‡†å¤‡ã€‚
- `conftest.py`ï¼špytest-fixture ç®¡ç†ï¼ˆæ¯”å¦‚è¯»å–å…¨å±€é…ç½®ã€åˆå§‹åŒ–å®¢æˆ·ç«¯ã€æ¸…ç†ï¼‰ã€‚

ç¼–å†™æ–°ç”¨ä¾‹ï¼ˆå¿«é€ŸæŒ‡å—ï¼‰

1. åœ¨ `cases/` ä¸­æ·»åŠ æµ‹è¯•æ•°æ®ï¼ˆJSON æˆ– YAMLï¼‰ã€‚
2. åœ¨ `tests/` ä¸­æ–°å¢æµ‹è¯•æ–‡ä»¶ï¼Œä½¿ç”¨ `core/api_client.py` å‘èµ·è¯·æ±‚å¹¶æ–­è¨€å“åº”ã€‚
3. ä½¿ç”¨ `utils/assertions.py` ä¸­çš„æ–­è¨€è¾…åŠ©å‡½æ•°ä¿æŒæ–­è¨€é£æ ¼ä¸€è‡´ã€‚

å¸¸ç”¨å‘½ä»¤å‚è€ƒ

- è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶ï¼š

```bash
pytest tests/test_user_api.py -q
```

- è¿è¡Œå¹¶ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„æŠ¥å‘Šï¼ˆç¤ºä¾‹ï¼‰ï¼š

```bash
REPORT_NAME=reports/report_$(date +%F_%H-%M-%S).html
pytest --html="$REPORT_NAME"
```

æ³¨æ„äº‹é¡¹ä¸å»ºè®®

- è¯·åœ¨ `config/settings.py` ä¸­ç®¡ç†ç¯å¢ƒç›¸å…³é…ç½®ï¼ˆå¦‚æµ‹è¯•ç¯å¢ƒ base URLã€æ•°æ®åº“è¿æ¥ç­‰ï¼‰ï¼Œå¹¶é¿å…å°†æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€å¯†é’¥ï¼‰æäº¤åˆ°ä»£ç ä»“åº“ã€‚å¯ä½¿ç”¨ `.env` æ–‡ä»¶é…åˆ `python-dotenv` ç®¡ç†æœ¬åœ°ç¯å¢ƒå˜é‡ã€‚
- è‹¥æœ‰æŒç»­é›†æˆï¼ˆCIï¼‰ï¼Œå»ºè®®åœ¨ CI æ­¥éª¤ä¸­åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶è¿è¡Œ `pytest --html=reports/report.html`ï¼Œç„¶åå°† `reports/` ç›®å½•ä½œä¸ºæ„å»ºäº§ç‰©ä¿å­˜ã€‚



